<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç¾¤æ„›ç…å­æœƒ - å³æ™‚å‡ºå¸­ç‹€æ³</title>
    <style>
        body { margin: 0; padding: 0; background-color: #222; color: white; font-family: "Microsoft JhengHei", sans-serif; overflow: hidden; }
        
        /* ä¸Šæ–¹æ¨™é¡Œå€ */
        .header { background: linear-gradient(90deg, #b48811 0%, #fbd050 50%, #b48811 100%); padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); height: 12vh; box-sizing: border-box; }
        .title { font-size: 4vh; font-weight: 900; color: #4a3403; text-shadow: 1px 1px 0px rgba(255,255,255,0.4); }
        
        /* å³ä¸Šè§’è¨ˆæ•¸å™¨ */
        .counter-box { background-color: #fff; padding: 10px 30px; border-radius: 10px; color: #b48811; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .count-label { font-size: 1.5vh; font-weight: bold; color: #555; }
        .count-number { font-size: 5vh; font-weight: 800; line-height: 1; }
        
        /* ä¸‹æ–¹åå–®å€ */
        .content { height: 88vh; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding-bottom: 50px; }
        
        /* åç‰‡å¡ */
        .card { background-color: #333; border: 2px solid #555; border-radius: 10px; padding: 15px; text-align: center; transition: 0.3s; position: relative; overflow: hidden; }
        .card.new-arrival { border-color: #fbd050; animation: flash 2s infinite; background-color: #443c22; }
        
        .card-job { font-size: 0.9rem; color: #fbd050; margin-bottom: 5px; font-weight: bold; }
        .card-name { font-size: 1.8rem; font-weight: bold; color: #fff; margin-bottom: 5px; }
        .card-note { font-size: 0.8rem; color: #aaa; background: rgba(255,255,255,0.1); display: inline-block; padding: 2px 8px; border-radius: 4px; }
        
        @keyframes flash { 0% { box-shadow: 0 0 5px #fbd050; } 50% { box-shadow: 0 0 20px #fbd050; } 100% { box-shadow: 0 0 5px #fbd050; } }

        /* è®€å–ä¸­ */
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #888; font-size: 1.5rem; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title">ğŸ¦ ç¾¤æ„›ç…å­æœƒ ä¾‹æœƒå‡ºå¸­æˆ°æƒ…å®¤</div>
        <div class="counter-box">
            <div class="count-label">ç›®å‰å‡ºå¸­</div>
            <div class="count-number" id="totalCount">0</div>
        </div>
    </div>

    <div class="content">
        <div id="loading">è¼‰å…¥è³‡æ–™ä¸­...</div>
        <div class="grid-container" id="grid">
            </div>
    </div>

    <script>
        // â˜…â˜…â˜… è«‹å¡«å…¥æ‚¨çš„ GAS ç¶²å€ â˜…â˜…â˜…
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyPT4Joi9U2kQisNsWEb-odpD-mifTcs1h44h60-fdwWh-ulh2l8bGHnXmtWn9Gy76Y/exec";
        
        // è¨­å®šæ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡
        setInterval(fetchData, 5000);
        fetchData(); // ç¶²é æ‰“é–‹å…ˆè·‘ä¸€æ¬¡

        let previousCount = 0;

        function fetchData() {
            // åŠ ä¸Šåƒæ•¸ action=getDashboard
            fetch(GAS_URL + "?action=getDashboard")
            .then(res => res.json())
            .then(data => {
                render(data);
            })
            .catch(err => console.error("æ›´æ–°å¤±æ•—", err));
        }

        function render(data) {
            document.getElementById("loading").style.display = "none";
            
            // æ›´æ–°æ•¸å­—
            const countElem = document.getElementById("totalCount");
            // å¦‚æœäººæ•¸è®Šå¤šï¼Œåšå€‹ç°¡å–®ç‰¹æ•ˆ
            if (data.count > previousCount) {
                countElem.style.color = "red";
                setTimeout(() => countElem.style.color = "#b48811", 500);
            }
            countElem.innerText = data.count;
            previousCount = data.count;

            // æ›´æ–°åå–®
            const grid = document.getElementById("grid");
            grid.innerHTML = ""; // æ¸…ç©ºèˆŠçš„

            // å€’åºæ’åˆ— (æœ€æ–°çš„åœ¨æœ€å‰é¢)
            // åŸå§‹è³‡æ–™é€šå¸¸æ˜¯æŒ‰ç…§è¡¨æ ¼é †åºï¼Œè‹¥æƒ³è®“æœ€æ–°çš„é¡¯ç¤ºåœ¨æœ€å‰é¢ï¼Œå¯è‡ªè¡Œæ±ºå®š
            // é€™è£¡ç¶­æŒè¡¨æ ¼é †åºï¼Œæˆ–è€…æ‚¨å¯ä»¥ array.reverse()
            
            data.list.forEach(person => {
                const card = document.createElement("div");
                card.className = "card";
                
                // é€™è£¡åˆ¤æ–·ï¼šå¦‚æœæ˜¯è·ç¨±å¾ˆé«˜çš„äººï¼Œå¯ä»¥åŠ ç‰¹åˆ¥æ¨£å¼ (æ­¤è™•çœç•¥)
                
                let html = `<div class="card-job">${person.job}</div>
                            <div class="card-name">${person.name}</div>`;
                
                if (person.note) {
                    html += `<div class="card-note">è¦ªå‹: ${person.note}</div>`;
                }

                card.innerHTML = html;
                grid.appendChild(card);
            });
        }
    </script>
</body>
</html>