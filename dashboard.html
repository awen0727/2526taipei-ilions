<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç¾¤æ„›ç…å­æœƒ - å‡ºå¸­ç°½åˆ°ç°¿ (V6-åˆ†é¡è¨ˆæ•¸ç‰ˆ)</title>
    <style>
        /* --- V6 é›™æ¬„ä½ + åˆ†é¡è¨ˆæ•¸ç‰ˆ --- */
        
        body { margin: 0; padding: 0; background-color: rgba(0,0,0,0.85); color: white; font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; overflow: hidden; }
        
        /* æ¨™é¡Œå€ */
        .header { 
            background: linear-gradient(90deg, #b48811 0%, #fbd050 100%); 
            padding: 10px 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            height: 9vh; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
            border-bottom: 2px solid #fff; 
        }
        
        .title { font-size: 1.6rem; font-weight: 900; color: #4a3403; letter-spacing: 1px; }
        
        /* çµ±è¨ˆæ•¸æ“šå€ (åŒ…å«å…©å€‹å°ç›’å­) */
        .stats-container {
            display: flex;
            gap: 15px; /* å…©å€‹ç›’å­ä¸­é–“çš„è·é›¢ */
        }

        /* é€šç”¨è¨ˆæ•¸ç›’æ¨£å¼ */
        .stat-box { 
            padding: 5px 15px; 
            border-radius: 12px; 
            display: flex; 
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            min-width: 100px;
            justify-content: space-between;
        }

        /* æœƒå“¡ç›’å­ (ç™½è‰²åº•ï¼Œé‡‘è‰²å­—) */
        .stat-box.member { background-color: rgba(255,255,255,0.95); color: #b48811; }
        /* ä¾†è³“ç›’å­ (æ·±ç´…åº•ï¼Œç™½å­—ï¼Œå€éš”æ˜é¡¯) */
        .stat-box.guest { background-color: #d32f2f; color: #fff; }

        .count-label { font-size: 0.9rem; font-weight: bold; margin-right: 8px;}
        .count-number { font-size: 2rem; font-weight: 900; line-height: 1; }
        
        /* å…§å®¹å€ */
        .content { height: 91vh; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        
        /* é›™æ¬„ä½æ’ç‰ˆ */
        .grid-container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            padding-bottom: 50px; 
        }
        
        /* åç‰‡å¡ */
        .card { 
            background: linear-gradient(90deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.02) 100%); 
            border-left: 8px solid #fbd050; 
            border-radius: 8px; 
            padding: 12px 15px; 
            text-align: left; 
            position: relative; 
            display: flex; 
            flex-direction: column; 
            justify-content: center;
            transition: all 0.3s; 
            min-height: 80px; 
        }
        
        /* ä¾†è³“å¡ç‰‡ç‰¹åˆ¥æ¨£å¼ (å¯é¸ï¼Œè®“ä¾†è³“å¡ç‰‡åœ¨åˆ—è¡¨è£¡ä¹Ÿé•·å¾—ä¸ä¸€æ¨£) */
        .card.is-guest { border-left-color: #d32f2f; background: linear-gradient(90deg, rgba(211, 47, 47, 0.2) 0%, rgba(255,255,255,0.02) 100%); }

        .card.new-arrival { animation: flashMedium 2s infinite; background-color: rgba(180, 136, 17, 0.4); border-left-color: #fff; }
        
        .info-group { display: flex; flex-direction: column; }
        
        .card-job { font-size: 1rem; color: #fbd050; font-weight: bold; margin-bottom: 3px; letter-spacing: 1px;}
        /* ä¾†è³“è·ç¨±è®Šç´… */
        .card.is-guest .card-job { color: #ff8a80; }

        .card-name { font-size: 2rem; font-weight: 800; color: #fff; line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } 
        
        .card-note-container { position: absolute; top: 10px; right: 10px; }
        .card-note { font-size: 0.8rem; color: #222; background: #fbd050; padding: 2px 8px; border-radius: 10px; font-weight: bold; }
        
        @keyframes flashMedium { 0% { border-left-color: #fbd050; box-shadow: 0 0 5px #fbd050; } 50% { border-left-color: #ffffff; box-shadow: 0 0 15px #fbd050; } 100% { border-left-color: #fbd050; box-shadow: 0 0 5px #fbd050; } }
        
        #loading { text-align: center; color: #aaa; margin-top: 50px; font-size: 1.5rem; grid-column: span 2; }
        
        /* éš±è—æ²è»¸ */
        .content::-webkit-scrollbar { width: 8px; }
        .content::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .content::-webkit-scrollbar-thumb { background: #fbd050; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title">ğŸ¦ ç¾¤æ„›ç…å­æœƒ</div>
        
        <div class="stats-container">
            <div class="stat-box member">
                <div class="count-label">æœƒå“¡</div>
                <div class="count-number" id="memberCount">0</div>
            </div>
            <div class="stat-box guest">
                <div class="count-label">ä¾†è³“</div>
                <div class="count-number" id="guestCount">0</div>
            </div>
        </div>
    </div>

    <div class="content">
        <div id="loading">é€£ç·šè³‡æ–™åº«ä¸­...</div>
        <div class="grid-container" id="grid">
            </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyPT4Joi9U2kQisNsWEb-odpD-mifTcs1h44h60-fdwWh-ulh2l8bGHnXmtWn9Gy76Y/exec";
        
        setInterval(fetchData, 5000);
        fetchData(); 

        // ç´€éŒ„èˆŠçš„æ•¸å­—ä»¥ä¾¿åšå‹•ç•«
        let prevMember = 0;
        let prevGuest = 0;

        function fetchData() {
            fetch(GAS_URL + "?action=getDashboard")
            .then(res => res.json())
            .then(data => {
                render(data);
            })
            .catch(err => {
                console.error("æ›´æ–°å¤±æ•—", err);
                document.getElementById("loading").innerText = "é€£ç·šå¤±æ•—ï¼Œé‡è©¦ä¸­...";
            });
        }

        function render(data) {
            document.getElementById("loading").style.display = "none";
            
            // â˜…â˜…â˜… è¨ˆç®—é‚è¼¯ â˜…â˜…â˜…
            // ç¯©é¸è·ç¨±æ˜¯ã€Œä¾†è³“ã€çš„æ•¸é‡
            const guestCount = data.list.filter(p => p.job === "ä¾†è³“").length;
            // å‰©ä¸‹çš„éƒ½æ˜¯æœƒå“¡
            const memberCount = data.count - guestCount;

            // æ›´æ–°æ•¸å­— DOM
            const memberElem = document.getElementById("memberCount");
            const guestElem = document.getElementById("guestCount");

            memberElem.innerText = memberCount;
            guestElem.innerText = guestCount;

            // ç°¡å–®çš„æ•¸å­—è·³å‹•æ•ˆæœ
            if (memberCount > prevMember) memberElem.style.color = "#d32f2f";
            setTimeout(() => memberElem.style.color = "#b48811", 500); // æœƒå“¡å›æ­¸é‡‘è‰²

            if (guestCount > prevGuest) guestElem.style.color = "#ffff00"; 
            setTimeout(() => guestElem.style.color = "#fff", 500); // ä¾†è³“å›æ­¸ç™½è‰²
            
            prevMember = memberCount;
            prevGuest = guestCount;

            // æ›´æ–°åˆ—è¡¨
            const grid = document.getElementById("grid");
            grid.innerHTML = ""; 

            const reversedList = data.list.slice().reverse();

            reversedList.forEach(person => {
                const card = document.createElement("div");
                
                // åˆ¤æ–·æ˜¯å¦ç‚ºä¾†è³“ï¼Œçµ¦äºˆä¸åŒçš„ CSS class
                let cardClass = "card";
                if (person.job === "ä¾†è³“") {
                    cardClass += " is-guest";
                }
                card.className = cardClass;
                
                let html = `
                    <div class="info-group">
                        <div class="card-job">${person.job}</div>
                        <div class="card-name">${person.name}</div>
                    </div>`;
                
                if (person.note) {
                    html += `<div class="card-note-container"><span class="card-note">${person.note}</span></div>`;
                }

                card.innerHTML = html;
                grid.appendChild(card);
            });
        }
    </script>
</body>
</html>
