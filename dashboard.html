<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç¾¤æ„›ç…å­æœƒ - æˆ°æƒ…å®¤ (V6.6 600pxæœ€ä½³åŒ–)</title>
    <style>
        /* --- V6.6 é‡å° OBS å¯¬åº¦ 600px çš„æœ€ä½³åŒ–èª¿æ ¡ --- */
        
        body { 
            margin: 0; padding: 0; 
            background-color: rgba(0,0,0,0.85); 
            color: white; 
            /* â˜…â˜…â˜… ä¿®å¾©ï¼šåŠ å…¥æ›´å¤š Emoji å­—å‹æ”¯æ´ï¼Œè§£æ±ºæ–¹å¡Šå•é¡Œ â˜…â˜…â˜… */
            font-family: "Microsoft JhengHei", "Heiti TC", "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif; 
            overflow: hidden; 
        }
        
        /* æ¨™é¡Œå€ï¼šåœ¨ 600px å¯¬åº¦ä¸‹ï¼Œå·¦å³é‚Šè·ç¸®å°ä¸€é»ä»¥å®¹ç´å…§å®¹ */
        .header { 
            background: linear-gradient(90deg, #b48811 0%, #fbd050 100%); 
            padding: 10px 15px; /* ç¸®å°é‚Šè· */
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            height: auto;
            min-height: 80px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.6); 
            border-bottom: 2px solid #fff; 
        }
        
        /* å·¦é‚Šæ¨™é¡Œ */
        .title-group { display: flex; flex-direction: column; }
        .title-main { font-size: 1.4rem; font-weight: 900; color: #4a3403; letter-spacing: 1px; line-height: 1.2;} /* å­—é«”å¾®èª¿é©æ‡‰çª„ç‰ˆ */
        .title-sub { font-size: 0.8rem; font-weight: bold; color: #6d4c05; letter-spacing: 1px; text-transform: uppercase;}
        
        /* å³é‚Šçµ±è¨ˆå€å¡Š */
        .stats-group {
            display: flex;
            gap: 8px; /* ç›’å­é–“è·ç¸®å° */
        }

        .counter-box { 
            background-color: #fff; 
            padding: 5px 10px; /* å…§è·ç¸®å° */
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
            display: flex; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 65px; /* ç¸®å°æœ€å°å¯¬åº¦ */
        }
        
        .count-label { font-size: 0.75rem; font-weight: bold; color: #888; margin-bottom: -2px;}
        .count-number { font-size: 2.2rem; font-weight: 900; line-height: 1.1; font-family: Impact, sans-serif; }
        
        #memberCount { color: #d32f2f; }
        #guestCount { color: #1565c0; }
        
        /* å…§å®¹å€ */
        .content { height: 1100px; /* é…åˆ OBS é«˜åº¦ */ padding: 15px; box-sizing: border-box; overflow-y: auto; }
        
        /* é›™æ¬„è¨­å®šï¼šé–“è·å¾®èª¿ */
        .grid-container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; /* é–“è·ç¸®å°ï¼Œè®“å¡ç‰‡æœ¬èº«å¯¬ä¸€é» */
            padding-bottom: 80px; 
        }
        
        /* åç‰‡å¡ */
        .card { 
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.02) 100%); 
            border-left: 8px solid #fbd050; /* é‡‘æ¢ç¨å¾®è®Šç´° */
            border-radius: 8px; 
            padding: 12px 10px; /* å…§è·ç¸®å°ï¼Œçˆ­å–æ–‡å­—ç©ºé–“ */
            position: relative; 
            display: flex; 
            flex-direction: column; 
            justify-content: center;
            min-height: 90px; 
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .card.is-guest { border-left-color: #42a5f5; }
        .card.new-arrival { animation: flash 2s infinite; background-color: rgba(180, 136, 17, 0.5); border-left-color: #fff; }
        
        /* â˜… è·ç¨±èª¿æ•´ï¼šé©æ‡‰ 600px å¯¬åº¦ */
        .card-job { 
            font-size: 1.1rem; /* å¾®èª¿ */
            color: #fbd050; 
            font-weight: 800; 
            margin-bottom: 3px; 
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .card.is-guest .card-job { color: #42a5f5; }
        
        /* â˜… åå­—èª¿æ•´ï¼šç¢ºä¿ä¸æ›è¡Œ */
        .card-name { 
            font-size: 1.8rem; /* å¾ 2.4 æ”¹ç‚º 1.8ï¼Œé¿å…åå­—å¤ªé•·è¢«åˆ‡æ‰ */
            font-weight: 900; 
            color: #fff; 
            line-height: 1.1; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        } 
        
        .card-note-container { position: absolute; top: 8px; right: 8px; }
        .card-note { font-size: 0.7rem; color: #222; background: #fbd050; padding: 2px 6px; border-radius: 8px; font-weight: bold; }
        
        @keyframes flash { 0% { border-left-color: #fbd050; box-shadow: 0 0 5px #fbd050; } 50% { border-left-color: #ffffff; box-shadow: 0 0 20px #fbd050; } 100% { border-left-color: #fbd050; box-shadow: 0 0 5px #fbd050; } }
        
        #loading { text-align: center; color: #aaa; margin-top: 50px; font-size: 1.2rem; grid-column: span 2; }
        
        /* éš±è—æ²è»¸ */
        .content::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title-group">
            <div class="title-main">ğŸ¦ ç¾¤æ„›ç…å­æœƒ</div>
            <div class="title-sub">GATHERING CHECK-IN</div>
        </div>
        
        <div class="stats-group">
            <div class="counter-box">
                <div class="count-label">æœƒå“¡</div>
                <div class="count-number" id="memberCount">0</div>
            </div>
            <div class="counter-box">
                <div class="count-label">ä¾†è³“</div>
                <div class="count-number" id="guestCount">0</div>
            </div>
        </div>
    </div>

    <div class="content">
        <div id="loading">é€£ç·šè³‡æ–™åº«ä¸­...</div>
        <div class="grid-container" id="grid">
            </div>
    </div>

    <script>
        // â˜…â˜…â˜… æ‚¨çš„ GAS ç¶²å€ (ç¶­æŒä¸è®Š) â˜…â˜…â˜…
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyPT4Joi9U2kQisNsWEb-odpD-mifTcs1h44h60-fdwWh-ulh2l8bGHnXmtWn9Gy76Y/exec";
        
        setInterval(fetchData, 5000);
        fetchData(); 

        let prevMemberCount = 0;
        let prevGuestCount = 0;

        function fetchData() {
            fetch(GAS_URL + "?action=getDashboard")
            .then(res => res.json())
            .then(data => {
                render(data);
            })
            .catch(err => {
                console.error("æ›´æ–°å¤±æ•—", err);
                // å¤±æ•—æ™‚ä¿æŒéœé»˜
            });
        }

        function render(data) {
            document.getElementById("loading").style.display = "none";
            
            let memberCount = 0;
            let guestCount = 0;

            data.list.forEach(person => {
                // åˆ¤æ–·é‚è¼¯ï¼šè·ç¨±åŒ…å« "ä¾†è³“" æˆ– "è²´è³“"
                if (person.job.includes("ä¾†è³“") || person.job.includes("è²´è³“")) {
                    guestCount++;
                } else {
                    memberCount++;
                }
            });

            // æ›´æ–°æœƒå“¡
            const mElem = document.getElementById("memberCount");
            mElem.innerText = memberCount;
            if (memberCount > prevMemberCount) {
                mElem.style.color = "#ffff00"; 
                setTimeout(() => mElem.style.color = "#d32f2f", 500); 
            }
            prevMemberCount = memberCount;

            // æ›´æ–°ä¾†è³“
            const gElem = document.getElementById("guestCount");
            gElem.innerText = guestCount;
            if (guestCount > prevGuestCount) {
                gElem.style.color = "#ffff00"; 
                setTimeout(() => gElem.style.color = "#1565c0", 500); 
            }
            prevGuestCount = guestCount;

            // æ¸²æŸ“åå–®
            const grid = document.getElementById("grid");
            grid.innerHTML = ""; 

            const reversedList = data.list.slice().reverse();

            reversedList.forEach(person => {
                const card = document.createElement("div");
                card.className = "card";
                
                if (person.job.includes("ä¾†è³“") || person.job.includes("è²´è³“")) {
                    card.classList.add("is-guest");
                }

                let html = `
                    <div class="info-group">
                        <div class="card-job">${person.job}</div>
                        <div class="card-name">${person.name}</div>
                    </div>`;
                
                if (person.note) {
                    html += `<div class="card-note-container"><span class="card-note">${person.note}</span></div>`;
                }

                card.innerHTML = html;
                grid.appendChild(card);
            });
        }
    </script>
</body>
</html>
